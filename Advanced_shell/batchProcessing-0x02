#!/bin/bash

# List of Pok√©mon to fetch
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# API base URL
base_url="https://pokeapi.co/api/v2/pokemon"

# Delay between requests (seconds)
delay_seconds=2

# Max number of retry attempts per Pok√©mon
max_retries=3

# Clear or create error log
> errors.txt

for name in "${pokemon_list[@]}"; do
  file_name="${name}.json"
  url="${base_url}/${name}"
  echo "üîç Fetching data for $name..."

  attempt=1
  success=false

  while [ $attempt -le $max_retries ]; do
    echo "  Attempt $attempt..."
    http_status=$(curl -s -w "%{http_code}" -o "$file_name" "$url")

    if [ "$http_status" -eq 200 ]; then
      echo "  ‚úÖ Success: $file_name saved."
      success=true
      break
    else
      echo "  ‚ùå Failed (HTTP $http_status)"
      rm -f "$file_name"  # Delete bad response
      ((attempt++))
      sleep "$delay_seconds"
    fi
  done

  if [ "$success" = false ]; then
    echo "‚ùó ERROR: Failed to fetch $name after $max_retries attempts." | tee -a errors.txt
  fi

  # Respectful delay before next Pok√©mon
  sleep "$delay_seconds"
done

